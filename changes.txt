(Στο process)
    DROP PROCEDURE IF EXISTS UpdateThesis;
DELIMITER $$

CREATE PROCEDURE UpdateThesis(
    IN p_thesis_id INT,
    IN p_title VARCHAR(255),
    IN p_description TEXT,
    IN p_status VARCHAR(50),
    IN p_start_date DATE,
    IN p_end_date DATE
)
BEGIN
    -- Ενημέρωση της Διπλωματικής
    UPDATE Theses
    SET title = p_title,
        description = p_description,
        status = p_status,
        start_date = p_start_date,
        end_date = p_end_date
    WHERE thesis_id = p_thesis_id;

    -- Καταγραφή στο ιστορικό αλλαγών (thesislogs)
    INSERT INTO thesislogs (thesis_id, thesis_title, action, log_timestamp, reason, action_date)
    VALUES (p_thesis_id, p_title, 'Update', NOW(), 'Ενημέρωση πληροφοριών διπλωματικής', NOW());
END $$

DELIMITER ;

(στο process)
2:
DROP PROCEDURE IF EXISTS DeleteThesis;
DELIMITER $$

CREATE PROCEDURE DeleteThesis(
    IN p_thesis_id INT
)
BEGIN
    -- Αποθήκευση της διαγραφής στον πίνακα Deleted_Theses
    INSERT INTO Deleted_Theses (thesis_id, title, supervisor_id, gs_number, deleted_at)
    SELECT thesis_id, title, supervisor_id, gs_number, NOW() 
    FROM Theses WHERE thesis_id = p_thesis_id;

    -- Καταγραφή στο ιστορικό αλλαγών (thesislogs)
    INSERT INTO thesislogs (thesis_id, thesis_title, action, log_timestamp, reason, action_date)
    VALUES (p_thesis_id, (SELECT title FROM Theses WHERE thesis_id = p_thesis_id), 'Delete', NOW(), 'Διαγραφή διπλωματικής', NOW());

    -- Διαγραφή της διπλωματικής
    DELETE FROM Theses WHERE thesis_id = p_thesis_id;
END $$

DELIMITER ;

(Στο addthesis)
3:
DELIMITER $$

CREATE PROCEDURE AddThesis(
    IN p_title VARCHAR(255),
    IN p_description TEXT,
    IN p_status ENUM('Υπό Ανάθεση','Ενεργή','Υπό Εξέταση','Περατωμένη'),
    IN p_start_date DATE,
    IN p_end_date DATE,
    IN p_supervisor_id INT
)
BEGIN
    INSERT INTO Theses (title, description, status, start_date, end_date, supervisor_id)
    VALUES (p_title, p_description, p_status, p_start_date, p_end_date, p_supervisor_id);
END $$

DELIMITER ;


(Στο provoliproskliseon)
4:
DELIMITER $$

CREATE PROCEDURE RespondToInvitation(
    IN p_invitation_id INT,
    IN p_action ENUM('Accepted', 'Rejected')
)
BEGIN
    UPDATE committeeinvitations
    SET status = p_action, responded_at = NOW()
    WHERE invitation_id = p_invitation_id;
END $$

DELIMITER ;


5:
ALTER TABLE Theses ADD COLUMN last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP;

6: CREATE TABLE deleted_theses (
    id INT AUTO_INCREMENT PRIMARY KEY,
    thesis_id INT NOT NULL,
    title VARCHAR(255) NOT NULL,
    deleted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

6:
ALTER TABLE theses ADD PRIMARY KEY (thesis_id);

7:
CREATE TABLE IF NOT EXISTS attachments (
    attachment_id INT AUTO_INCREMENT PRIMARY KEY,
    thesis_id INT NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_url VARCHAR(500) NOT NULL,
    file_type VARCHAR(50) NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_thesis FOREIGN KEY (thesis_id) REFERENCES theses(thesis_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

8:
ALTER TABLE professors ADD PRIMARY KEY (professor_id);

9: CREATE TABLE exam_results (
    result_id INT AUTO_INCREMENT PRIMARY KEY,
    thesis_id INT NOT NULL,
    professor_id INT NOT NULL,
    grade DECIMAL(3,2) DEFAULT NULL,
    report TEXT DEFAULT NULL,
    exam_date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

10: ALTER TABLE exam_results 
ADD CONSTRAINT fk_thesis FOREIGN KEY (thesis_id) 
REFERENCES theses(thesis_id) ON DELETE CASCADE;

ALTER TABLE exam_results 
ADD CONSTRAINT fk_professor FOREIGN KEY (professor_id) 
REFERENCES professors(professor_id) ON DELETE SET NULL;


11: ALTER TABLE attachments ADD COLUMN uploader_id INT NOT NULL;

12:CREATE TABLE professors_notifications (
    notification_id INT AUTO_INCREMENT PRIMARY KEY,
    student_id INT NOT NULL,
    thesis_id INT NOT NULL,
    professor_id INT NOT NULL,
    status ENUM('Pending', 'Accepted', 'Rejected') DEFAULT 'Pending',
    sent_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    responded_at TIMESTAMP NULL,
    response_message TEXT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

13:ALTER TABLE professors_notifications
ADD CONSTRAINT thesis_foreignkey FOREIGN KEY (thesis_id) 
REFERENCES theses(thesis_id) ON DELETE CASCADE;

14: ALTER TABLE professors_notifications
ADD CONSTRAINT student_foreignkey FOREIGN KEY (student_id) 
REFERENCES students(student_id) ON DELETE CASCADE;

15:ALTER TABLE professors_notifications
ADD CONSTRAINT professor_foreignkey FOREIGN KEY (professor_id) 
REFERENCES professors(professor_id) ON DELETE CASCADE;

16: CREATE PROCEDURE SendInvitationToProfessor(
    IN p_student_id INT,
    IN p_thesis_id INT,
    IN p_professor_id INT
)
BEGIN
    
    -- Αποθήκευση της ειδοποίησης στον πίνακα professors_notifications
    INSERT INTO professors_notifications (student_id, thesis_id, professor_id, status, sent_at)
    VALUES (p_student_id, p_thesis_id, p_professor_id, 'Pending', NOW());

END $$

17: DELIMITER $$

CREATE PROCEDURE SendFormInvitationToProfessor(
    IN p_student_id INT,
    IN p_thesis_id INT,
    IN p_professor_id INT,
    IN p_topic VARCHAR(255),  -- Προσθήκη θέματος (topic)
    IN p_message TEXT         -- Προσθήκη μηνύματος (message)
)
BEGIN
    -- Αποθήκευση της ειδοποίησης στον πίνακα form
    INSERT INTO form (student_id, theses_id, professor_id, topic, message, created_at)
    VALUES (p_student_id, p_thesis_id, p_professor_id, p_topic, p_message, NOW());

END $$

DELIMITER ;

18: DELIMITER //
CREATE PROCEDURE UpdateUserProfile(
    IN p_user_id INT,
    IN p_user_type VARCHAR(20),
    IN p_street VARCHAR(255),
    IN p_number VARCHAR(10),
    IN p_city VARCHAR(100),
    IN p_postcode VARCHAR(20),
    IN p_mobile_phone VARCHAR(20),
    IN p_landline_phone VARCHAR(20),
    IN p_department VARCHAR(100),
    IN p_university VARCHAR(100),
    IN p_phone VARCHAR(20)
)
BEGIN
    IF p_user_type = 'student' THEN
        UPDATE students 
        SET street = p_street, 
            number = p_number, 
            city = p_city, 
            postcode = p_postcode, 
            mobile_telephone = p_mobile_phone, 
            landline_telephone = p_landline_phone
        WHERE student_id = p_user_id;
    ELSEIF p_user_type = 'professor' THEN
        UPDATE professors 
        SET mobile = p_mobile_phone, 
            landline = p_landline_phone, 
            department = p_department, 
            university = p_university
        WHERE professor_id = p_user_id;
    ELSEIF p_user_type = 'secretary' THEN
        UPDATE grammateia 
        SET phone = p_phone
        WHERE grammateia_id = p_user_id;
    END IF;
END //
DELIMITER ;

19: CREATE TABLE presentations (
    presentation_id INT AUTO_INCREMENT PRIMARY KEY,
    thesis_id INT NOT NULL,
    exam_date DATE NOT NULL,
    exam_time TIME NOT NULL,
    exam_type ENUM('δια ζώσης', 'διαδικτυακά') NOT NULL,
    location TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (thesis_id) REFERENCES theses(thesis_id) ON DELETE CASCADE
);

------ 2/8/2025------------
20: ALTER TABLE theses ADD PRIMARY KEY (thesis_id);

21: CREATE TABLE examinations (
    exam_id INT AUTO_INCREMENT PRIMARY KEY,
    thesis_id INT NOT NULL,
    exam_date DATE NOT NULL,
    exam_time TIME NOT NULL,
    exam_mode ENUM('δια ζώσης', 'διαδικτυακά') NOT NULL,
    room VARCHAR(100) DEFAULT NULL,
    link VARCHAR(255) DEFAULT NULL,
    FOREIGN KEY (thesis_id) REFERENCES theses(thesis_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

22: DROP PROCEDURE IF EXISTS SendInvitationToProfessor;

DELIMITER $$

CREATE PROCEDURE SendInvitationToProfessor(
    IN studentId INT,
    IN thesisId INT,
    IN professorId INT,
    IN comments TEXT
)
BEGIN
    INSERT INTO invitations (student_id, thesis_id, professor_id, comments)
    VALUES (studentId, thesisId, professorId, comments);
END$$

DELIMITER ;

23: CREATE TABLE professor_notes (
         note_id INT AUTO_INCREMENT PRIMARY KEY,
         thesis_id INT NOT NULL,
         professor_id INT NOT NULL,
         note_text VARCHAR(300) NOT NULL,
         created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
         FOREIGN KEY (thesis_id) REFERENCES theses(thesis_id) ON DELETE CASCADE,
         FOREIGN KEY (professor_id) REFERENCES professors(professor_id) ON DELETE CASCADE
       );

24:ALTER TABLE theses
  ADD COLUMN cancellation_ga_number VARCHAR(50) NULL AFTER cancellation_reason,
  ADD COLUMN cancellation_ga_year INT NULL AFTER cancellation_ga_number;


ΑΡΧΙΚΗ ΒΑΣΗ 

CREATE TABLE `users` (
  `user_id` int(11) NOT NULL,
  `email` varchar(100) NOT NULL,
  `password` varchar(255) NOT NULL,
  `user_type` enum('student','professor','secretary') NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;


INSERT INTO `users` (`user_id`, `email`, `password`, `user_type`) VALUES
(100, 'st10434047@upnet.gr', 'studpass1', 'student'),
(101, 'st10434048@upnet.gr', 'studpass2', 'student'),
(102, 'st10434049@upnet.gr', 'studpass3', 'student'),
(103, 'st10434050@upnet.gr', 'studpass4', 'student'),
(104, 'st10434051@upnet.gr', 'studpass5', 'student'),
(105, 'st10434052@upnet.gr', 'studpass6', 'student'),
(106, 'st10434054@upnet.gr', 'studpass8', 'student'),
(107, 'st10434055@upnet.gr', 'studpass9', 'student'),
(108, 'st10434056@upnet.gr', 'studpass10', 'student'),
(109, 'st10434057@upnet.gr', 'studpass11', 'student'),
(110, 'st10434060@upnet.gr', 'studpass14', 'student'),
(111, 'st10434061@upnet.gr', 'studpass15', 'student'),
(112, 'st10434062@upnet.gr', 'studpass16', 'student'),
(113, 'st10434063@upnet.gr', 'studpass17', 'student'),
(114, 'st10434064@upnet.gr', 'studpass18', 'student'),
(115, 'st10434065@upnet.gr', 'studpass19', 'student'),
(116, 'st10434066@upnet.gr', 'studpass20', 'student'),
(117, 'st10434067@upnet.gr', 'studpass21', 'student'),
(200, 'prakomninos@upnet.gr', 'profpass1', 'professor'),
(201, 'prvasfou@upnet.gr', 'profpass2', 'professor'),
(202, 'prkarras@upnet.gr', 'profpass3', 'professor'),
(203, 'preleni@upnet.gr', 'profpass4', 'professor'),
(204, 'prhozier@upnet.gr', 'profpass5', 'professor'),
(205, 'prnikoskorobos@upnet.gr', 'profpass6', 'professor'),
(206, 'prkostkaranik@upnet.gr', 'profpass7', 'professor'),
(207, 'prjimnik@upnet.gr', 'profpass8', 'professor'),
(208, 'prsophiamich@upnet.gr', 'profpass9', 'professor'),
(209, 'prmichaelpap@upnet.gr', 'profpass10', 'professor'),
(210, 'prgeopan@upnet.gr', 'profpass11', 'professor'),
(211, 'prmariaalex@upnet.gr', 'profpass12', 'professor'),
(212, 'priannis@upnet.gr', 'profpass13', 'professor'),
(213, 'prelenipap@upnet.gr', 'profpass14', 'professor'),
(214, 'prdimitrislaz@upnet.gr', 'profpass15', 'professor'),
(215, 'prannakollia@upnet.gr', 'profpass16', 'professor'),
(216, 'prchrispapa@upnet.gr', 'profpass17', 'professor'),
(217, 'prfotismark@upnet.gr', 'profpass18', 'professor'),
(218, 'prstellakara@upnet.gr', 'profpass19', 'professor'),
(219, 'prpetroszach@upnet.gr', 'profpass20', 'professor'),
(300, 'grpapadopoulou@upnet.gr', 'grampass0', 'secretary'),
(301, 'grdimopoulos@upnet.gr', 'grampass1', 'secretary'),
(302, 'gralemoni@upnet.gr', 'grampass2', 'secretary'),
(303, 'grkaragiannis@upnet.gr', 'grampass3', 'secretary'),
(304, 'grkarras@upnet.gr', 'grampass4', 'secretary'),
(305, 'grmarkopoulos@upnet.gr', 'grampass5', 'secretary'),
(306, 'grpapageorgiou@upnet.gr', 'grampass6', 'secretary'),
(307, 'grakonstantinou@upnet.gr', 'grampass7', 'secretary'),
(308, 'grstamatiou@upnet.gr', 'grampass8', 'secretary'),
(309, 'grzacharopoulou@upnet.gr', 'grampass9', 'secretary'),
(310, 'grtsiolis@upnet.gr', 'grampass10', 'secretary'),
(311, 'grperraki@upnet.gr', 'grampass11', 'secretary'),
(312, 'grpanagopoulou@upnet.gr', 'grampass12', 'secretary');
CREATE TABLE `students` (
  `student_id` int(11) NOT NULL,
  `name` varchar(50) NOT NULL,
  `surname` varchar(50) NOT NULL,
  `student_number` varchar(50) NOT NULL,
  `street` varchar(100) DEFAULT NULL,
  `number` varchar(10) DEFAULT NULL,
  `city` varchar(50) DEFAULT NULL,
  `postcode` varchar(20) DEFAULT NULL,
  `father_name` varchar(50) DEFAULT NULL,
  `landline_telephone` varchar(15) DEFAULT NULL,
  `mobile_telephone` varchar(15) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
--
-- Άδειασμα δεδομένων του πίνακα `students`
--
INSERT INTO `students` (`student_id`, `name`, `surname`, `student_number`, `street`, `number`, `city`, `postcode`, `father_name`, `landline_telephone`, `mobile_telephone`) VALUES
(100, 'Μaria', 'Nikolaou', '10434047', 'Achilleos', '21', 'Athens', '10437', 'Dimitris', '2109278907', '6945533213'),
(101, 'Eleni', 'Fotiou', '10434048', 'Adrianou', '65', 'Athens', '10556', 'Nikos', '2108745645', '6978989000'),
(102, 'Xara', 'Fanouriou', '10434049', 'Chaonias', '54', 'Athens', '10441', 'Petros', '2108724324', '6945622222'),
(103, 'Nikos', 'Panagiotou', '10434050', 'Chomatianou', '32', 'Athens', '10439', 'Giorgos', '2107655555', '6941133333'),
(104, 'Petros', 'Daidalos', '10434051', 'Dafnidos', '4', 'Athens', '11364', 'Pavlos', '2108534566', '6976644333'),
(105, 'Giannis', 'Ioannou', '10434052', 'Danais', '9', 'Athens', '11631', 'Kostas', '2107644999', '6976565655'),
(106, 'Elena', 'Antoniou', '10434054', 'Ermou', '24', 'Athens', '10563', 'Nikolaos', '2105678901', '6935678901'),
(107, 'Ioannis', 'Panagiotou', '10434055', 'Kyprou', '42', 'Patra', '26441', 'Kwstas', '2610123456', '6981234567'),
(108, 'George', 'Karamalis', '10434056', 'Kolokotroni', '10', 'Larissa', '41222', 'Petros', '2410456789', '6974567890'),
(109, 'Kyriakos', 'Papapetrou', '10434057', 'Zakunthou', '36', 'Volos', '10654', 'Apostolos', '2106789012', '6956789012'),
(110, 'Kostas', 'Papadopoulos', '10434060', 'Lykourgou', '15', 'Athens', '11524', 'Christos', '2107654321', '6937654321'),
(111, 'Maria', 'Gavala', '10434061', 'Platonos', '32', 'Thessaloniki', '54634', 'Antonis', '2310123789', '6951237890'),
(112, 'Fotis', 'Maniatis', '10434062', 'Artemidos', '18', 'Heraklion', '71306', 'Andreas', '2810654321', '6976543210'),
(113, 'Elena', 'Tzoumakis', '10434063', 'Perikleous', '7', 'Ioannina', '45444', 'Dimitrios', '26510456789', '698-4567891'),
(114, 'Christina', 'Petraki', '10434064', 'Dionysiou', '45', 'Volos', '38334', 'Manolis', '24210987654', '6949876543'),
(115, 'Nikolas', 'Tzortzis', '10434065', 'Aristotelous', '23', 'Larissa', '41234', 'Stavros', '2410123456', '6971234567'),
(116, 'Anna', 'Kalliga', '10434066', 'Thiseos', '11', 'Athens', '11743', 'Vasilis', '2105432198', '6935432198'),
(117, 'Alexandros', 'Karas', '10434067', 'Dimosthenous', '12', 'Patra', '26222', 'Konstantinos', '2610765432', '6957654321');
CREATE TABLE `professors` (
  `professor_id` int(11) NOT NULL,
  `name` varchar(50) NOT NULL,
  `surname` varchar(50) NOT NULL,
  `topic` varchar(100) DEFAULT NULL,
  `landline` varchar(15) DEFAULT NULL,
  `mobile` varchar(15) DEFAULT NULL,
  `department` varchar(100) DEFAULT NULL,
  `university` varchar(100) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
--
-- Άδειασμα δεδομένων του πίνακα `professors`
--
INSERT INTO `professors` (`professor_id`, `name`, `surname`, `topic`, `landline`, `mobile`, `department`, `university`) VALUES
(200, 'Andreas', 'Komninos', 'Network-centric systems', '2610996915', '6977998877', 'CEID', 'University of Patras'),
(201, 'Vasilis', 'Foukaras', 'Integrated Systems', '2610885511', '6988812345', 'CEID', 'University of Patras'),
(202, 'Basilis', 'Karras', 'Artificial Intelligence', '23', '545', 'CEID', 'University of Patras'),
(203, 'Eleni', 'Voyiatzaki', 'WEB', '34', '245', 'CEID', 'University of Patras'),
(204, 'Andrew', 'Hozier Byrne', 'Artificial Intelligence', '2610170390', '6917031990', 'CEID', 'University of Patras'),
(205, 'Nikos', 'Korobos', 'Data Engineering', '2610324365', '6978530352', 'IT', 'University of Patras'),
(206, 'Kostas', 'Karanikolos', 'informatics', '2610324242', '6934539920', 'CEID', 'University of Patras'),
(207, 'Jim', 'Nikolaou', 'Artificial Intelligence', '26109876543', '6979876543', 'Computer Science', 'University of Patras'),
(208, 'Sophia', 'Michailidi', 'Economic Theory', '23105432109', '6985432109', 'Economics', 'Athens University of Economics and Business'),
(209, 'Michael', 'Papadreou', 'Renewable Energy Systems', '26104455667', '6974455667', 'Electrical Engineering', 'University of Ioannina'),
(210, 'George', 'Panagiotopoulos', 'Machine Learning', '26104455678', '6974455678', 'Computer Science', 'University of Patras'),
(211, 'Maria', 'Alexiou', 'Robotics', '2610778899', '6977788899', 'Electrical Engineering', 'University of Patras'),
(212, 'Ioannis', 'Tsoukalas', 'Data Science', '2310334455', '6940334455', 'Informatics', 'Aristotle University of Thessaloniki'),
(213, 'Eleni', 'Papadimitriou', 'Environmental Engineering', '2310445566', '6980445566', 'Environmental Science', 'University of Ioannina'),
(214, 'Dimitris', 'Lazaridis', 'Cybersecurity', '2610556677', '6977556677', 'IT', 'University of Patras'),
(215, 'Anna', 'Kollia', 'Cloud Computing', '2101234567', '6981234567', 'Computer Engineering', 'National Technical University of Athens'),
(216, 'Christos', 'Papanikolaou', 'Bioinformatics', '2109876543', '6949876543', 'Biology', 'University of Crete'),
(217, 'Fotis', 'Markou', 'Blockchain Technology', '2610112233', '6970112233', 'Computer Science', 'University of Patras'),
(218, 'Stella', 'Karagianni', 'Cultural Economics', '2104567890', '6984567890', 'Economics', 'Athens University of Economics and Business'),
(219, 'Petros', 'Zaharopoulos', 'Renewable Energy Systems', '2610667788', '6976667788', 'Electrical Engineering', 'University of Ioannina');
CREATE TABLE `grammateia` (
  `grammateia_id` int(11) NOT NULL,
  `full_name` varchar(255) NOT NULL,
  `phone` varchar(20) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
INSERT INTO Grammateia (grammateia_id, full_name, phone)
VALUES
(300, 'Γεωργία Παπαδοπούλου', '2610123456'),
(301, 'Κωνσταντίνος Δημόπουλος',  '2610654321'),
(302, 'Αντωνία Λεμονή','2610111222'),
(303, 'Σπυρίδων Καραγιάννης', '2610333444'),
(304, 'Ελένη Καρρά', '2610555666'),
(305, 'Παναγιώτης Μαρκόπουλος', '2610777888'),
(306, 'Δημήτριος Παπαγεωργίου', '2610999000'),
(307, 'Αναστασία Κωνσταντίνου', '2610222333'),
(308, 'Γιώργος Σταματίου', '2610444555'),
(309,  'Μαρία Ζαχαροπούλου', '2610666777'),
(310, 'Αλέξανδρος Τσιόλης', '2610888999'),
(311, 'Νίκη Περράκη',  '2610111000'),
(312, 'Χριστίνα Παναγοπούλου','2610333666');
-- Δομή πίνακα για τον πίνακα `theses`
--
CREATE TABLE `theses` (
  `thesis_id` int(11) NOT NULL,
  `title` varchar(255) NOT NULL,
  `description` text DEFAULT NULL,
  `status` enum('Υπό Ανάθεση','Ενεργή','Υπό Εξέταση','Περατωμένη') DEFAULT 'Υπό Ανάθεση',
  `start_date` date DEFAULT NULL,
  `end_date` date DEFAULT NULL,
  `final_grade` decimal(3,2) DEFAULT NULL,
  `student_id` int(11) DEFAULT NULL,
  `supervisor_id` int(11) DEFAULT NULL,
  `repository_link` varchar(255) DEFAULT NULL,
  `cancellation_reason` text DEFAULT NULL,
  `approval_gs_number` varchar(20) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
--
-- Άδειασμα δεδομένων του πίνακα `theses`
--
INSERT INTO `theses` (`thesis_id`, `title`, `description`, `status`, `start_date`, `end_date`, `final_grade`, `student_id`, `supervisor_id`, `repository_link`, `cancellation_reason`, `approval_gs_number`) VALUES
(1, 'Ανάπτυξη Εφαρμογής Διαχείρισης Εργασιών με AI', 'Εφαρμογή που χρησιμοποιεί AI για ταξινόμηση και παρακολούθηση καθημερινών εργασιών.', 'Ενεργή', '2025-10-01', NULL, NULL, 106, 206, NULL, NULL, '2024/001'),
(2, 'Ανάλυση Δεδομένων Κοινωνικών Δικτύων', 'Εξαγωγή και ανάλυση δεδομένων από Twitter για την ανίχνευση τάσεων.', 'Υπό Εξέταση', '2025-09-15', NULL, NULL, 101, 201, NULL, NULL, '2024/002'),
(3, 'Διαχείριση Εφοδιαστικής Αλυσίδας με Blockchain', 'Σχεδιασμός διαφανούς συστήματος διαχείρισης εφοδιαστικής αλυσίδας.', 'Περατωμένη', '2024-09-01', '2025-06-01', 9.25, 104, 204, 'https://repository.university.gr/thesis/123', NULL, '2023/015'),
(4, 'Ανάπτυξη Συστημάτων Ανίχνευσης Κακόβουλου Λογισμικού', 'Εφαρμογή ανίχνευσης malware με μηχανική μάθηση.', 'Υπό Ανάθεση', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL),
(5, 'Σύστημα Προβλέψεων Καιρού με Χρήση Machine Learning', 'Δημιουργία αλγορίθμου πρόβλεψης καιρού με χρήση ιστορικών δεδομένων.', 'Περατωμένη', '2024-08-01', '2025-05-15', 8.75, 100, 200, 'https://repository.university.gr/thesis/124', NULL, '2023/020'),
(6, 'Ανάπτυξη Εφαρμογής Οπτικής Αναγνώρισης Χειρόγραφων Κειμένων', 'Ανάπτυξη συστήματος OCR για χειρόγραφα κείμενα σε πολυγλωσσικό περιβάλλον.', 'Περατωμένη', '2024-10-01', '2025-04-30', 9.50, 116, 216, 'https://repository.university.gr/thesis/125', NULL, '2023/021'),
(7, 'Εφαρμογή Εντοπισμού Διαρροών σε Δίκτυα Ύδρευσης', 'Ανάλυση δεδομένων από αισθητήρες για εντοπισμό διαρροών σε δίκτυα ύδρευσης.', 'Περατωμένη', '2024-06-15', '2025-02-28', 8.25, 105, 205, 'https://repository.university.gr/thesis/126', NULL, '2023/018'),
(8, 'Ανάπτυξη Εικονικών Περιβαλλόντων για Εκπαίδευση με AR/VR', 'Δημιουργία εικονικών περιβαλλόντων για εξ αποστάσεως εκπαίδευση.', 'Υπό Εξέταση', '2025-01-15', NULL, NULL, 102, 202, NULL, NULL, '2024/003'),
(9, 'Αυτοματισμός Οικιακών Συστημάτων με IoT', 'Ανάπτυξη συστήματος ελέγχου και αυτοματοποίησης για έξυπνα σπίτια.', 'Υπό Εξέταση', '2025-03-01', NULL, NULL, 103, 203, NULL, NULL, '2024/004'),
(10, 'Ανάλυση Συναισθήματος σε Κείμενα με AI', 'Εξαγωγή συναισθηματικών χαρακτηριστικών από κείμενα χρησιμοποιώντας AI.', 'Ενεργή', '2025-05-01', NULL, NULL, 107, 207, NULL, NULL, '2024/005'),
(11, 'Βελτιστοποίηση Αλγορίθμων Αναζήτησης σε Μεγάλες Βάσεις Δεδομένων', 'Ανάπτυξη και βελτιστοποίηση αλγορίθμων αναζήτησης σε NoSQL βάσεις.', 'Ενεργή', '2025-02-15', NULL, NULL, 108, 208, NULL, NULL, '2024/006'),
(12, 'Διαχείριση Ενέργειας με Συστήματα IoT', 'Ανάπτυξη συστήματος παρακολούθησης και βελτιστοποίησης κατανάλωσης ενέργειας.', 'Υπό Ανάθεση', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL),
(13, 'Αυτόματη Διάγνωση Ιατρικών Εικόνων με AI', 'Ανάπτυξη εφαρμογής ανάλυσης ιατρικών εικόνων για διάγνωση ασθενειών.', 'Υπό Ανάθεση', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
CREATE TABLE `committees` (
  `committee_id` int(11) NOT NULL,
  `thesis_id` int(11) NOT NULL,
  `supervisor_id` int(11) NOT NULL,
  `member1_id` int(11) NOT NULL,
  `member2_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
--
-- Άδειασμα δεδομένων του πίνακα `committees`
--
INSERT INTO `committees` (`committee_id`, `thesis_id`, `supervisor_id`, `member1_id`, `member2_id`) VALUES
(1, 3, 204, 209, 210),
(2, 5, 200, 211, 212),
(3, 6, 216, 219, 208),
(4, 7, 205, 200, 217),
(5, 2, 201, 209, 210),
(6, 8, 202, 200, 219),
(7, 9, 203, 216, 218),
(8, 1, 206, 216, 214),
(9, 10, 207, 217, 215),
(10, 11, 208, 219, 218);
CREATE TABLE `committeeinvitations` (
  `invitation_id` int(11) NOT NULL,
  `thesis_id` int(11) DEFAULT NULL,
  `invited_professor_id` int(11) DEFAULT NULL,
  `status` enum('Pending','Accepted','Rejected') DEFAULT 'Pending',
  `sent_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `responded_at` timestamp NULL DEFAULT NULL,
  `comments` text DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
--
-- Άδειασμα δεδομένων του πίνακα `committeeinvitations`
--
INSERT INTO `committeeinvitations` (`invitation_id`, `thesis_id`, `invited_professor_id`, `status`, `sent_at`, `responded_at`, `comments`) VALUES
(1, 4, 210, 'Pending', '2025-01-15 06:45:00', NULL, 'Παρακαλώ απαντήστε έως 2025-01-25.'),
(2, 13, 215, 'Pending', '2025-02-05 11:00:00', NULL, 'Πρόσκληση για αξιολόγηση διπλωματικής εργασίας.'),
(3, 12, 211, 'Pending', '2025-02-20 13:00:00', NULL, 'Παρακαλώ επιβεβαιώστε τη διαθεσιμότητά σας.'),
(4, 7, 218, 'Rejected', '2025-01-20 12:00:00', '2025-01-20 14:45:00', 'Λυπάμαι, αλλά λόγω φόρτου εργασίας δεν μπορώ να συμμετάσχω.'),
(5, 10, 200, 'Rejected', '2025-01-19 09:00:00', '2025-01-20 07:00:00', 'Δυστυχώς δεν μπορώ να παραστώ λόγω προγραμματισμένων ταξιδιών.'),
(6, 11, 205, 'Rejected', '2025-01-25 14:30:00', '2025-01-26 08:45:00', 'Δεν μπορώ να συμμετάσχω λόγω ανειλημμένων υποχρεώσεων.'),
(7, 6, 208, 'Accepted', '2025-01-20 08:15:00', '2025-01-21 09:30:00', 'Θα χαρώ να συμμετάσχω στην επιτροπή.'),
(8, 5, 211, 'Accepted', '2025-02-01 07:30:00', '2025-02-01 12:00:00', 'Ευχαριστώ. Είμαι διαθέσιμος για τη συνεδρία.'),
(9, 7, 200, 'Accepted', '2025-02-15 08:00:00', '2025-02-16 06:00:00', 'Επιβεβαιώνω τη συμμετοχή μου στην επιτροπή.'),
(10, 11, 218, 'Accepted', '2025-01-18 10:00:00', '2025-01-19 08:00:00', 'Θα συμμετάσχω.');

ΑΛΛΑΓΕΣ ΓΙΑ ΓΡΑΜΜΑΤΕΙΑ:
1Γ. 

DELIMITER //

CREATE PROCEDURE cancelThesis(
    IN p_thesis_id INT,
    IN p_reason TEXT,
    IN p_gs_number INT,
    IN p_gs_year INT
)
BEGIN
    -- Εισαγωγή στο log
    INSERT INTO ThesisLogs (thesis_id, action, reason, gs_number, gs_year)
    VALUES (p_thesis_id, 'Ακύρωση', p_reason, p_gs_number, p_gs_year);

    -- Αντί για DELETE, κάνουμε UPDATE της κατάστασης
    UPDATE Theses
    SET status = 'Ακυρωμένη'
    WHERE thesis_id = p_thesis_id;
END //

DELIMITER ;



2Γ. 

DELIMITER //

CREATE PROCEDURE completeThesis(
    IN p_thesis_id INT
)
BEGIN
    UPDATE Theses
    SET status = 'Περατωμένη'
    WHERE thesis_id = p_thesis_id;

    INSERT INTO ThesisLogs (thesis_id, action)
    VALUES (p_thesis_id, 'Ολοκλήρωση');
END //

DELIMITER ;

 

3Γ. ALTER TABLE thesislogs
DROP FOREIGN KEY thesislogs_ibfk_1;

4Γ.ALTER TABLE thesislogs
MODIFY COLUMN thesis_id INT NULL;

5Γ. ALTER TABLE thesislogs
ADD CONSTRAINT thesislogs_ibfk_1
FOREIGN KEY (thesis_id) REFERENCES theses(thesis_id)
ON DELETE SET NULL;



6Γ. INSERT INTO `theses` (`thesis_id`, `title`, `description`, `status`, `start_date`, `end_date`, `student_id`, `supervisor_id`, `repository_link`, `cancellation_reason`, `approval_gs_number`) VALUES
(20, 'Εφαρμογή Τεχνητής Νοημοσύνης σε Δίκτυα', 'Ανάπτυξη AI για βελτιστοποίηση δικτύων.', 'Υπό Εξέταση', '2025-06-01', NULL, 120, 200, NULL, NULL, '2024/012'),
(21, 'Ανάπτυξη Εφαρμογών Blockchain', 'Χρήση blockchain για ασφαλείς συναλλαγές.', 'Υπό Εξέταση', '2025-07-01', NULL, 121, 205, 'https://repository.university.gr/thesis/21', NULL, '2024/013'),
(22, 'Μηχανική Μάθηση για Ανίχνευση Κακόβουλου Λογισμικού', 'Χρήση ML για εντοπισμό malware.', 'Υπό Εξέταση', '2025-05-15', NULL, 122, 207, NULL, NULL, '2024/014'),
(23, 'Ανάλυση Οικονομικών Δεδομένων με AI', 'Εφαρμογή AI για οικονομικές προβλέψεις.', 'Υπό Εξέταση', '2025-04-20', NULL, 123, 218, 'https://repository.university.gr/thesis/23', NULL, '2024/015'),
(24, 'Ρομποτική για Βιοϊατρικές Εφαρμογές', 'Ανάπτυξη ρομπότ για ιατρική χρήση.', 'Υπό Εξέταση', '2025-03-10', NULL, 124, 211, NULL, NULL, '2024/016');

7Γ. DROP TRIGGER IF EXISTS after_thesis_update;
8Γ. DROP TRIGGER IF EXISTS after_thesis_delete;

9Γ. UPDATE `theses` 
SET `grade` = 8.5, 
    `repository_link` = 'https://repository.university.gr/thesis/20'
WHERE `thesis_id` = 20;

UPDATE `theses` 
SET `grade` = 9.0 
WHERE `thesis_id` = 21;

UPDATE `theses` 
SET `grade` = 8.7, 
    `repository_link` = 'https://repository.university.gr/thesis/22'
WHERE `thesis_id` = 22;

UPDATE `theses` 
SET `grade` = 9.2 
WHERE `thesis_id` = 23;

UPDATE `theses` 
SET `grade` = 9.5, 
    `repository_link` = 'https://repository.university.gr/thesis/24'
WHERE `thesis_id` = 24;

UPDATE `theses` 
SET `repository_link` = CONCAT('https://repository.university.gr/thesis/', `thesis_id`)
WHERE `thesis_id` BETWEEN 20 AND 24;

..........................................................................
ΓΙΑ ΓΡΑΜΜΑΤΕΙΑ ΚΑΙ ΦΕΤΣ 
1.
DELIMITER $$

CREATE PROCEDURE cancelThesis(
    IN p_thesis_id INT,
    IN p_reason TEXT,
    IN p_gs_number INT,
    IN p_gs_year INT
)
BEGIN
    -- Ενημέρωση κατάστασης σε 'Ακυρωμένη'
    UPDATE Theses
    SET 
        status = 'Ακυρωμένη',
        cancelation_reason = p_reason,
        cancel_gs_number = p_gs_number,
        cancel_gs_year = p_gs_year,
        end_date = CURDATE()
    WHERE thesis_id = p_thesis_id;
END $$

DELIMITER ;


2.
DELIMITER $$

CREATE PROCEDURE completeThesis(
    IN p_thesis_id INT
)
BEGIN
    -- Ενημέρωση κατάστασης σε 'Ολοκληρωμένη' και καταχώρηση ημερομηνίας λήξης
    UPDATE Theses
    SET 
        status = 'Ολοκληρωμένη',
        end_date = CURDATE()
    WHERE thesis_id = p_thesis_id;
END $$

DELIMITER ;

......................................................
ΓΙΑ ΤΙΣ ΑΝΑΚΟΙΝΩΣΕΙΣ ΣΤΟ ΛΟΓΚΙΝ 


http://localhost/MYWEBSITE1/announcements.php?from=01092025&to=31102025&format=xml
http://localhost/MYWEBSITE1/announcements.php?from=01092025&to=30092025&format=json

CREATE TABLE Announcements (
    id INT AUTO_INCREMENT PRIMARY KEY,
    date DATE NOT NULL,
    time TIME NOT NULL,
    title VARCHAR(255) NOT NULL,
    announcement_text TEXT NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO Announcements (date, time, title, announcement_text)
VALUES
('2025-09-10', '11:00:00', 'Δημόσια Παρουσίαση Διπλωματικής Ιωάννη Παπαδόπουλου',
 'Την 10/09/2025 και ώρα 11:00 θα παρουσιαστεί η διπλωματική του Ιωάννη Παπαδόπουλου στην αίθουσα Α1.'),

('2025-09-12', '13:30:00', 'Δημόσια Παρουσίαση Διπλωματικής Μαρίας Κωνσταντίνου',
 'Την 12/09/2025 και ώρα 13:30 θα παρουσιαστεί η διπλωματική της Μαρίας Κωνσταντίνου στην αίθουσα Β2.'),

('2025-09-15', '12:00:00', 'Δημόσια Παρουσίαση Διπλωματικής Τάδε Ταδόπουλου',
 'Την 15/09/2025 και ώρα 12:00 θα παρουσιαστεί η διπλωματική του Τάδε Ταδόπουλου στην αίθουσα Β1.'),

('2025-09-18', '09:30:00', 'Δημόσια Παρουσίαση Διπλωματικής Άννας Γεωργίου',
 'Την 18/09/2025 και ώρα 09:30 θα παρουσιαστεί η διπλωματική της Άννας Γεωργίου στην αίθουσα Γ1.'),

('2025-09-20', '10:30:00', 'Δημόσια Παρουσίαση Διπλωματικής Δείνα Δεινόπουλου',
 'Την 20/09/2025 και ώρα 10:30 θα παρουσιαστεί η διπλωματική του Δείνα Δεινόπουλου στην αίθουσα Γ2.'),

('2025-09-22', '14:00:00', 'Δημόσια Παρουσίαση Διπλωματικής Χρήστου Νικολάου',
 'Την 22/09/2025 και ώρα 14:00 θα παρουσιαστεί η διπλωματική του Χρήστου Νικολάου στην αίθουσα Δ1.'),

('2025-09-25', '16:00:00', 'Δημόσια Παρουσίαση Διπλωματικής Ελένης Δημητρίου',
 'Την 25/09/2025 και ώρα 16:00 θα παρουσιαστεί η διπλωματική της Ελένης Δημητρίου στην αίθουσα Ε2.'),

('2025-09-28', '11:45:00', 'Δημόσια Παρουσίαση Διπλωματικής Σπύρου Οικονόμου',
 'Την 28/09/2025 και ώρα 11:45 θα παρουσιαστεί η διπλωματική του Σπύρου Οικονόμου στην αίθουσα Ζ1.'),

('2025-10-02', '09:00:00', 'Δημόσια Παρουσίαση Διπλωματικής Αικατερίνης Σταμάτη',
 'Την 02/10/2025 και ώρα 09:00 θα παρουσιαστεί η διπλωματική της Αικατερίνης Σταμάτη στην αίθουσα Η1.'),

('2025-10-05', '12:15:00', 'Δημόσια Παρουσίαση Διπλωματικής Δημήτρη Παναγιώτου',
 'Την 05/10/2025 και ώρα 12:15 θα παρουσιαστεί η διπλωματική του Δημήτρη Παναγιώτου στην αίθουσα Θ2.');


ALTER TABLE users
  ADD UNIQUE KEY ux_users_email (email),
  ADD KEY ix_users_user_type (user_type);


ALTER TABLE students
  ADD UNIQUE KEY ux_students_student_number (student_number),
  ADD UNIQUE KEY ux_students_email (email),
  ADD KEY ix_students_surname_name (surname, name);

ALTER TABLE professors
  ADD UNIQUE KEY ux_professors_email (email),
  ADD KEY ix_professors_department (department),
  ADD KEY ix_professors_surname_name (surname, name);

ALTER TABLE theses
  ADD KEY ix_theses_supervisor_status_start (supervisor_id, status, start_date),
  ADD KEY ix_theses_student (student_id),
  ADD KEY ix_theses_status_start (status, start_date),
  ADD KEY ix_theses_start_date (start_date),
  ADD FULLTEXT KEY ftx_theses_title_desc (title, description);

ALTER TABLE committees
  ADD UNIQUE KEY ux_committees_thesis (thesis_id),
  ADD KEY ix_committees_supervisor (supervisor_id),
  ADD KEY ix_committees_member1 (member1_id),
  ADD KEY ix_committees_member2 (member2_id);

ALTER TABLE committeeinvitations
  ADD KEY ix_cinv_prof_status (professor_id, status, sent_at),
  ADD KEY ix_cinv_thesis (thesis_id),
  ADD KEY ix_cinv_sent_at (sent_at);

ALTER TABLE professors_notifications
  ADD KEY ix_pn_prof_status_time (professor_id, status, sent_at),
  ADD KEY ix_pn_thesis (thesis_id),
  ADD KEY ix_pn_student (student_id),
  ADD KEY ix_pn_sent_at (sent_at);


ALTER TABLE examinations
  ADD UNIQUE KEY ux_exams_thesis (thesis_id),
  ADD KEY ix_exams_date_time (exam_date, exam_time),
  ADD KEY ix_exams_mode (exam_mode);

ALTER TABLE exam_results
  ADD UNIQUE KEY ux_er_thesis_prof (thesis_id, professor_id),
  ADD KEY ix_er_thesis (thesis_id),
  ADD KEY ix_er_professor (professor_id);

ALTER TABLE professor_notes
  ADD KEY ix_pn_thesis_time (thesis_id, created_at),
  ADD KEY ix_pn_prof (professor_id),
  ADD KEY ix_pn_prof_thesis_time (professor_id, thesis_id, created_at);

ALTER TABLE attachments
  ADD KEY ix_att_thesis_time (thesis_id, uploaded_at),
  ADD KEY ix_att_student_time (student_id, uploaded_at);

ALTER TABLE announcements
  ADD KEY ix_ann_created (created_at),
  ADD FULLTEXT KEY ftx_ann_title_content (title, content);

ALTER TABLE grammateia
  ADD KEY ix_gram_created (created_at),
  ADD FULLTEXT KEY ftx_gram_title (title);

